"use strict";!function(){var a="undefined"!=typeof exports&&exports||"undefined"!=typeof define&&{}||this||window;"undefined"!=typeof define&&define("save-svg-as-png",[],function(){return a}),a.default=a;function r(e){return e instanceof HTMLElement||e instanceof SVGElement}function s(e){if(!r(e))throw new Error("an HTMLElement or SVGElement is required; got "+e)}function o(n){return new Promise(function(e,t){r(n)?e(n):t(new Error("an HTMLElement or SVGElement is required; got "+n))})}function m(e,t,n){var r=e.viewBox&&e.viewBox.baseVal&&e.viewBox.baseVal[n]||null!==t.getAttribute(n)&&!t.getAttribute(n).match(/%$/)&&parseInt(t.getAttribute(n))||e.getBoundingClientRect()[n]||parseInt(t.style[n])||parseInt(window.getComputedStyle(e).getPropertyValue(n));return null==r||isNaN(parseFloat(r))?0:r}function u(e){for(var t=window.atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r),i=0;i<t.length;i++)o[i]=t.charCodeAt(i);return new Blob([r],{type:n})}function f(e,t){var n=e.cssText.match(l),r=n&&n[1]||"";if(r&&!r.match(/^data:/)&&"about:blank"!==r){var o,i,a=r.startsWith("../")?t+"/../"+r:r.startsWith("./")?t+"/."+r:r;return{text:e.cssText,format:(o=a,(i=Object.keys(c).filter(function(e){return 0<o.indexOf("."+e)}).map(function(e){return c[e]}))?i[0]:(console.error("Unknown font format for "+o+". Fonts may not be working correctly."),"application/octet-stream")),url:a}}}function v(e){return Promise.all(Array.from(e.querySelectorAll("image")).map(function(o){var e,i=o.getAttributeNS("http://www.w3.org/1999/xlink","href")||o.getAttribute("href");return i?((e=i)&&0===e.lastIndexOf("http",0)&&-1===e.lastIndexOf(window.location.host)&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),new Promise(function(e,t){var n=document.createElement("canvas"),r=new Image;r.crossOrigin="anonymous",r.src=i,r.onerror=function(){return t(new Error("Could not load "+i))},r.onload=function(){n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0),o.setAttributeNS("http://www.w3.org/1999/xlink","href",n.toDataURL("image/png")),e(!0)}})):Promise.resolve(null)}))}function d(e){return Promise.all(e.map(function(o){return new Promise(function(n,e){if(h[o.url])return n(h[o.url]);var r=new XMLHttpRequest;r.addEventListener("load",function(){var e=function(e){for(var t="",n=new Uint8Array(e),r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}(r.response),t=o.text.replace(l,'url("data:'+o.format+";base64,"+e+'")')+"\n";h[o.url]=t,n(t)}),r.addEventListener("error",function(e){console.warn("Failed to load font from: "+o.url,e),h[o.url]=null,n(null)}),r.addEventListener("abort",function(e){console.warn("Aborted loading font from: "+o.url,e),n(null)}),r.open("GET",o.url),r.responseType="arraybuffer",r.send()})})).then(function(e){return e.filter(function(e){return e}).join("")})}function b(r,e){var t=e||{},n=t.selectorRemap,o=t.modifyStyle,i=t.fonts,a=t.excludeUnusedCss,s=t.modifyCss||function(e,t){return(n?n(e):e)+"{"+(o?o(t):t)+"}\n"},u=[],l=void 0===i,c=i||[];return(w=w||Array.from(document.styleSheets).map(function(t){try{return{rules:t.cssRules,href:t.href}}catch(e){return console.warn("Stylesheet could not be loaded: "+t.href,e),{}}})).forEach(function(e){var t=e.rules,n=e.href;t&&Array.from(t).forEach(function(e){var t;void 0!==e.style&&(!function(e,t){if(t)try{return e.querySelector(t)||e.parentNode&&e.parentNode.querySelector(t)}catch(e){console.warn('Invalid CSS selector "'+t+'"',e)}}(r,e.selectorText)?l&&e.cssText.match(/^@font-face/)?(t=f(e,n))&&c.push(t):a||u.push(e.cssText):u.push(s(e.selectorText,e.style.cssText)))})}),d(c).then(function(e){return u.join("\n")+e})}function i(){if(!(navigator.msSaveOrOpenBlob||"download"in document.createElement("a")))return{popup:window.open()}}var y="http://www.w3.org/2000/xmlns/",x="http://www.w3.org/2000/svg",l=/url\(["']?(.+?)["']?\)/,c={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},h={},w=null;a.prepareSvg=function(o,u,l){s(o);var e=u||{},t=e.left,c=void 0===t?0:t,n=e.top,f=void 0===n?0:n,d=e.width,h=e.height,r=e.scale,w=void 0===r?1:r,i=e.responsive,g=void 0!==i&&i,a=e.excludeCss,p=void 0!==a&&a;return v(o).then(function(){var i=o.cloneNode(!0);i.style.backgroundColor=(u||{}).backgroundColor||o.style.backgroundColor;var e=function(e,t,n,r){if("svg"===e.tagName)return{width:n||m(e,t,"width"),height:r||m(e,t,"height")};if(e.getBBox){var o=e.getBBox(),i=o.x,a=o.y;return{width:i+o.width,height:a+o.height}}}(o,i,d,h),a=e.width,s=e.height;if("svg"!==o.tagName){if(!o.getBBox)return void console.error("Attempted to render non-SVG element",o);null!=i.getAttribute("transform")&&i.setAttribute("transform",i.getAttribute("transform").replace(/translate\(.*?\)/,""));var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.appendChild(i),i=t}if(i.setAttribute("version","1.1"),i.setAttribute("viewBox",[c,f,a,s].join(" ")),i.getAttribute("xmlns")||i.setAttributeNS(y,"xmlns",x),i.getAttribute("xmlns:xlink")||i.setAttributeNS(y,"xmlns:xlink","http://www.w3.org/1999/xlink"),g?(i.removeAttribute("width"),i.removeAttribute("height"),i.setAttribute("preserveAspectRatio","xMinYMin meet")):(i.setAttribute("width",a*w),i.setAttribute("height",s*w)),Array.from(i.querySelectorAll("foreignObject > *")).forEach(function(e){e.setAttributeNS(y,"xmlns","svg"===e.tagName?x:"http://www.w3.org/1999/xhtml")}),!p)return b(o,u).then(function(e){var t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML="<![CDATA[\n"+e+"\n]]>";var n=document.createElement("defs");n.appendChild(t),i.insertBefore(n,i.firstChild);var r=document.createElement("div");r.appendChild(i);var o=r.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if("function"!=typeof l)return{src:o,width:a,height:s};l(o,a,s)});var n=document.createElement("div");n.appendChild(i);var r=n.innerHTML;if("function"!=typeof l)return{src:r,width:a,height:s};l(r,a,s)})},a.svgAsDataUri=function(e,t,i){return s(e),a.prepareSvg(e,t).then(function(e){var t=e.src,n=e.width,r=e.height,o="data:image/svg+xml;base64,"+window.btoa(decodeURIComponent(encodeURIComponent('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>'+t).replace(/%([0-9A-F]{2})/g,function(e,t){var n=String.fromCharCode("0x"+t);return"%"===n?"%25":n})));return"function"==typeof i&&i(o,n,r),o})},a.svgAsPngUri=function(e,t,u){s(e);function o(e){var t=e.src,n=e.width,r=e.height,o=document.createElement("canvas"),i=o.getContext("2d"),a=window.devicePixelRatio||1;o.width=n*a,o.height=r*a,o.style.width=o.width+"px",o.style.height=o.height+"px",i.setTransform(a,0,0,a,0,0),f?f(o,t):i.drawImage(t,0,0);var s=void 0;try{s=o.toDataURL(l,c)}catch(e){if("undefined"!=typeof SecurityError&&e instanceof SecurityError||"SecurityError"===e.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw e}return"function"==typeof u&&u(s,o.width,o.height),Promise.resolve(s)}var n=t||{},r=n.encoderType,l=void 0===r?"image/png":r,i=n.encoderOptions,c=void 0===i?.8:i,f=n.canvg;return f?a.prepareSvg(e,t).then(o):a.svgAsDataUri(e,t).then(function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){return e(o({src:n,width:n.width,height:n.height}))},n.onerror=function(){t("There was an error loading the data URI as an image on the following SVG\n"+window.atob(r.slice(26))+"Open the following link to see browser's diagnosis\n"+r)},n.src=r})})},a.download=function(e,t,n){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(u(t),e);else{var r=document.createElement("a");if("download"in r){r.download=e,r.style.display="none",document.body.appendChild(r);try{var o=u(t),i=URL.createObjectURL(o);r.href=i,r.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(i)})}}catch(e){console.error(e),console.warn("Error while getting object URL. Falling back to string URL."),r.href=t}r.click(),document.body.removeChild(r)}else n&&n.popup&&(n.popup.document.title=e,n.popup.location.replace(t))}},a.saveSvg=function(e,t,n){var r=i();return o(e).then(function(e){return a.svgAsDataUri(e,n||{})}).then(function(e){return a.download(t,e,r)})},a.saveSvgAsPng=function(e,t,n){var r=i();return o(e).then(function(e){return a.svgAsPngUri(e,n||{})}).then(function(e){return a.download(t,e,r)})}}();