<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
<title>Matt Worthington: Visualizing American School Finance</title>

<meta property="description" itemprop="description" content="Analyzing School Finances Revenue Breakdowns For Every State From 1993-2015"/>

<link rel="canonical" href="https://mrworthington.com/posts/school-finance-analysis/"/>
<link rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2018-03-28"/>
<meta property="article:created" itemprop="dateCreated" content="2018-03-28"/>
<meta name="article:author" content="Matt Worthington"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Matt Worthington: Visualizing American School Finance"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Analyzing School Finances Revenue Breakdowns For Every State From 1993-2015"/>
<meta property="og:url" content="https://mrworthington.com/posts/school-finance-analysis/"/>
<meta property="og:image" content="https://mrworthington.com/posts/school-finance-analysis/isabella-and-louisa-fischer-uSPjZzYwXO4-unsplash-2.jpg"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Matt Worthington"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Matt Worthington: Visualizing American School Finance"/>
<meta property="twitter:description" content="Analyzing School Finances Revenue Breakdowns For Every State From 1993-2015"/>
<meta property="twitter:url" content="https://mrworthington.com/posts/school-finance-analysis/"/>
<meta property="twitter:image" content="https://mrworthington.com/posts/school-finance-analysis/isabella-and-louisa-fischer-uSPjZzYwXO4-unsplash-2.jpg"/>
<meta property="twitter:creator" content="@mrworthington"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="Matt Worthington: Visualizing American School Finance"/>
<meta name="citation_fulltext_html_url" content="https://mrworthington.com/posts/school-finance-analysis/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2018/03/28"/>
<meta name="citation_publication_date" content="2018/03/28"/>
<meta name="citation_author" content="Matt Worthington"/>
<meta name="citation_author_institution" content="Me, Myself, and I"/>
<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","subtitle","description","author","date","creative_commons","output","preview","categories","twitter","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Visualizing American School Finance"]},{"type":"character","attributes":{},"value":[""]},{"type":"character","attributes":{},"value":["Analyzing School Finances Revenue Breakdowns For Every State From 1993-2015"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation","affiliation_url"]}},"value":[{"type":"character","attributes":{},"value":["Matt Worthington"]},{"type":"character","attributes":{},"value":["https://mrworthington.com/about.html"]},{"type":"character","attributes":{},"value":["Me, Myself, and I"]},{"type":"character","attributes":{},"value":["https://mrworthington.com"]}]}]},{"type":"character","attributes":{},"value":["03-28-2018"]},{"type":"character","attributes":{},"value":["CC BY-NC"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["css","self_contained"]}},"value":[{"type":"character","attributes":{},"value":["page_header.css"]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["isabella-and-louisa-fischer-uSPjZzYwXO4-unsplash-2.jpg"]},{"type":"character","attributes":{},"value":["School Finance","Public Education","Charter Schools","US Census Bureau"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creator"]}},"value":[{"type":"character","attributes":{},"value":["@mrworthington"]}]},{"type":"character","attributes":{},"value":["https://mrworthington.com/posts/school-finance-analysis/"]},{"type":"character","attributes":{},"value":["https://mrworthington.com/posts/school-finance-analysis/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["connectingtoftp.png","ftp-finderprompt.png","isabella-and-louisa-fischer-uSPjZzYwXO4-unsplash-2.jpg","page_header.css","school_finance_viz_us_files/bowser-1.9.3/bowser.min.js","school_finance_viz_us_files/distill-2.2.21/template.v2.js","school_finance_viz_us_files/jquery-1.11.3/jquery.min.js","school_finance_viz_us_files/webcomponents-2.0.0/webcomponents.js","SFNationalMapOT.png","SFNationalMapPP.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #455a64;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative;}
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for table of contents */

.d-toc {
  color: rgba(0,0,0,0.8);
  font-size: 0.8em;
  line-height: 1em;
}

.d-toc-header {
  font-size: 0.6rem;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.5);
  text-transform: uppercase;
  margin-top: 0;
  margin-bottom: 1.3em;
}

.d-toc a {
  border-bottom: none;
}

.d-toc ul {
  padding-left: 0;
}

.d-toc li>ul {
  padding-top: 0.8em;
  padding-left: 16px;
  margin-bottom: 0.6em;
}

.d-toc ul,
.d-toc li {
  list-style-type: none;
}

.d-toc li {
  margin-bottom: 0.9em;
}

.d-toc-separator {
  margin-top: 20px;
  margin-bottom: 2em;
}

.d-article-with-toc {
  border-top: none;
  padding-top: 0;
}



/* Tweak code blocks (note that this CSS is repeated above in an injection
   into the d-code shadow dom) */

d-code {
  overflow-x: auto !important;
}

pre.d-code code.d-code {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

pre.text-output {

  font-size: 12px;
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

@media(min-width: 768px) {

d-code {
  overflow-x: visible !important;
}

pre.d-code code.d-code  {
    padding-left: 18px;
    font-size: 14px;
}
pre.text-output {
  font-size: 14px;
}
}

/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}



/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}


/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // create d-bibliography
  var bibliography = $('<d-bibliography></d-bibliography>');
  $('#distill-bibliography').wrap(bibliography);

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace citations with <d-cite>
  $('.citation').each(function(i, val) {
    appendix = true;
    var cites = $(this).attr('data-cites').split(" ");
    var dt_cite = $('<d-cite></d-cite>');
    dt_cite.attr('key', cites.join());
    $(this).replaceWith(dt_cite);
  });
  // remove refs
  $('#refs').remove();

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-toc a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // replace code blocks with d-code
  $('pre>code').each(function(i, val) {
    var code = $(this);
    var pre = code.parent();
    var clz = "";
    var language = pre.attr('class');
    if (language) {
      // map unknown languages to "clike" (without this they just dissapear)
      if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                               "javascript", "js", "julia", "lua", "markdown",
                               "markup", "mathml", "python", "svg", "xml"]) == -1)
        language = "clike";
      language = ' language="' + language + '"';
      var dt_code = $('<d-code block' + language + clz + '></d-code>');
      dt_code.text(code.text());
      pre.replaceWith(dt_code);
    } else {
      code.addClass('text-output').unwrap().changeElementType('pre');
    }
  });

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('d-code, pre.text-output, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // table of contents
    if (have_authors) // adjust border if we are in authors
      $('.d-toc').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
    $('d-code').each(function(i, val) {
      var style = document.createElement('style');
      style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                        '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
      if (this.shadowRoot)
        this.shadowRoot.appendChild(style);
    });

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-toc-header').remove();
  $('.d-toc').remove();
  $('.d-toc-separator').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="school_finance_viz_us_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="school_finance_viz_us_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="school_finance_viz_us_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="school_finance_viz_us_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-52682113-1"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-52682113-1');
</script>
<style type="text/css">
@import url("https://cloud.typography.com/6771036/7342412/css/fonts.css");

d-article hr {
grid-column: screen;
width: 100%;
border: none;
border-bottom: 1px solid rgba(0, 0, 0, 0.1);
margin-top: 0px !important;
margin-bottom: 0px !important;
}

d-byline .byline {
grid-template-columns: 1fr 1fr;
grid-column: text;
font-family: "Ringside Narrow SSm A", "Ringside Narrow SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

d-article > d-code, d-article section > d-code {
display: block;
overflow-x: scroll !important;
background: #f8f8f8 !important;
border: 1px solid #ccc !important;
border-radius: 1px !important;
text-shadow: 0 0px white !important;
font-family: "Operator Mono SSm A", "Operator Mono SSm B", Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;

}

.highcharts-background{
  width: 100% !important;
}

.highcharts-plot-background{
  width: 100% !important;
}


.highcharts-container{
  width: 100% !important;
}

.highcharts-root{
  width: 100% !important;
}

.posts-list .posts-list-caption {
grid-column: screen;
font-family: "Whitney SSm A", "Whitney SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
font-weight: 400;
color: #7d7d7d;
letter-spacing: 0px;
}

d-article h4 {
font-weight: 700;
text-transform: revert;
font-size: 15px;
line-height: 1.4em;
}

d-article a {
color: #4d4d4d;
}

.distill-site-nav {
  color: #ffffff;
  font-family: "Gotham SSm A", "Gotham SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size: 15px;
  font-weight: 600;
  background: #4d4d4d;
  border-bottom: 2px solid #DECF40;
  -webkit-box-shadow: 1px 1px 18px #4d4d4d;
  -moz-box-shadow: 1px 1px 18px #4d4d4d;
  box-shadow: 1px 1px 18px #4d4d4d;
}

.distill-site-header .nav-left {
  margin-left: 0px;
  
}

.distill-site-header .nav-right {
/* margin-right: 20px; */
text-transform: uppercase;
font-size: 14px;
letter-spacing: 1px;
}

.distill-site-nav a:hover {
color: #2d2d2d !important;
background: #DECF40;
}

d-title {
padding-top: 10rem;
background: #4d4d4d;
font-family: "Gotham SSm A", "Gotham SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
font-weight: 800;
color: #fff;
}

d-title h1 {
font-weight: 800;
}

code {
color: #2A7DE1;
font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
}

d-article {
  color: #6B6D6F;
}

d-article h1 {
    font-weight: 800;
    color: #2d2d2d;
    font-family: "Gotham SSm A", "Gotham SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    letter-spacing: 0px !important;
}

::selection {
color: #2d2d2d;
text-shadow: none;
background: rgba(222,207,64, 0.4);
}

.posts-list .metadata .publishedDate {
font-family: "Ringside Narrow SSm A", "Ringside Narrow SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
text-transform: uppercase;
font-size: 1rem;
letter-spacing: .9px;
color: #9d9d9d;
}

.posts-list .post-preview h2 {
font-size: 30px !important;
font-weight: 700 !important;
letter-spacing:0px !important;
font-family: "Gotham SSm A", "Gotham SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
}

d-article h1 {
font-weight: 800;
color: #2d2d2d;
font-family: "Gotham SSm A", "Gotham SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
letter-spacing: 3px;
}

d-article h2 {
font-size: 24px;
font-family: "Whitney SSm A", "Whitney SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
font-weight: 500;
letter-spacing: 2px;
color: #6B6D6F;
border-bottom: 1.3px solid rgba(140, 143, 147, 0.5);
}

.highcharts-container text {
font-family: "Whitney SSm A", "Whitney SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif  !important;
}

body {
    font-family: "Whitney SSm A", "Whitney SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight: 400;
    overflow-x: hidden;
    overflow-y: auto
}

.posts-list .description h2, .posts-list .description p {
    font-family: "Gotham SSm A", "Gotham SSm B", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

.distill-site-header {
}

.distill-site-footer {
}

@media print {
  .distill-site-nav {
    display: none;
  }
}
</style>
<!--/radix_placeholder_site_in_header-->

  <link rel="stylesheet" href="page_header.css" type="text/css"/>

</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Visualizing American School Finance","description":"Analyzing School Finances Revenue Breakdowns For Every State From 1993-2015","authors":[{"author":"Matt Worthington","authorURL":"https://mrworthington.com/about.html","affiliation":"Me, Myself, and I","affiliationURL":"https://mrworthington.com"}],"publishedDate":"2018-03-28T00:00:00.000-07:00","citationText":"Worthington, 2018"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Matt Worthington</a>
</div>
<div class="nav-right">
<a href="https://mrworthington.com">Home</a>
<a href="../../about.html">About</a>
<a href="https://github.com/mrworthington">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/mrworthington">
<i class="fa fa-twitter" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Visualizing American School Finance</h1>
<p><p>Analyzing School Finances Revenue Breakdowns For Every State From 1993-2015</p></p>
</div>

<div class="d-byline">
  Matt Worthington <a href="https://mrworthington.com/about.html" class="uri">https://mrworthington.com/about.html</a> (Me, Myself, and I)<a href="https://mrworthington.com" class="uri">https://mrworthington.com</a>
  
<br/>03-28-2018
</div>

<div class="d-article">
<p>This evening, <a href="https://edtrust.org/resource/funding-gaps-2018/">the Ed Trust is hosting a discussion on twitter at 8PM ET</a> on school funding inequity, so I thought I would do a code-through of a visualization I made this past summer while researching the legacy of a famous school finance Supreme Court case that ended up determining that <a href="https://www.folomedia.org/americans-no-right-education/">Americans had no fundamental right to an education</a>. In short, it shows the shares of funding over time for each of the three main sources of funding for public education in America: federal funding, state funding, and local funding (mostly property taxes).</p>
<h1 id="why-visualize-school-finance">Why Visualize School Finance?</h1>
<p>In recent years, much has been debated about school funding, or the lack thereof. Notably, recent studies coming out of places like <a href="https://www.texastribune.org/2018/03/28/texas-am-lori-taylor-public-education-funding/">Texas A&amp;M</a> and <a href="http://usccr.gov/pubs/2018-01-10-Education-Inequity.pdf">the US Commission on Civil Rights</a> have highlighted funding deficits throughout America that not only threaten the futures of currently enrolled public school students, but <a href="https://www.texastribune.org/2018/03/20/texas-notice-credit-rating-downgrade-comptroller-says/">our future economies</a> throughout America.</p>
<p>You may not have children, but school finance impacts you regardless. And as one news executive said recently in a visit to one of my public policy classes, “school finance is the thing people should be talking about but will likely never get talked about.”</p>
<p>So here’s to helping people understand with clean visualizations. Alright, let’s see the map and get to the code-through.</p>
<h3 id="the-map">The Map</h3>
<div class="layout-chunk" data-layout="l-page">
<p><img src="SFNationalMapOT.png" width="3000" /></p>
</div>
<h1 id="the-code-through">The Code Through</h1>
<p>While we’ll visualize the three sources of funding, this dataset will organize a few other data points of use. While I’ll do my best to address what each one is, I may overlook a few variables. If I do, you can reach out to me or reach out to the folks at the Census’ Educational Finance Branch.</p>
<h3 id="accessing-all-the-data-used-here">Accessing All the Data Used Here</h3>
<p>For this code-through, <a href="https://github.com/mrworthington/fileshare/raw/master/sf-data.zip">you can download all the data used for this code-through from my github</a>, which includes the inflation &amp; state “FIPS” code data needed for the visualization to work properly. Just add it to whatever directory you’re working out of and you’ll be good to go.</p>
<h3 id="import-school-finance-data">Import School Finance Data</h3>
<p>While you already have the data, the US Census has been collecting data from every school district in the country since the 1960s. Using their FTP database, you can download the files here and other various datasets related to public finance. For our purposes, we’ll use their elementary and secondary school finance survey files and start from 1993 for a couple of reasons explained by clicking on the tooltips here<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>To access this raw data, you can go to the US Census FTP database where the school finance datasets are stored and download them into a folder there. First, <a href="ftp://ftp.census.gov/govs/school/">go to the FTP database</a>. Second, choose “Allow” when prompted and select guest when asked for authentication.</p>
<aside>
<img src="ftp-finderprompt.png" title="fig:" alt="First, hit “Allow”" />
</aside>
<p>Once you do this, you should see a dialogue showing your connection status that looks like this.</p>
<aside>
<img src="connectingtoftp.png" title="fig:" alt="You should see a connecting status like this before the remote disk loads the files." />
</aside>
<p>After the data downloads into the remote disk, find the files with the following labels highlighted in purple below (i.e., <code>"elsec.93.xls"</code>) and download them into a folder called “data”. Once you do that, save a .Rproj file into the same location and you’ll be able to run the code below without much trouble (I hope).</p>
<p>One note about my code. By no means am I an expert in R and when I produced this code, I knew way less about the <code>tidyverse</code> than I do now. If any other R folks have feedback, I’m 100% open to ways I can make this code cleaner and more efficient.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
setwd(&quot;data/&quot;)

#Import Census School Finance Data
sf1993 &lt;- read_excel(&quot;elsec93.xls&quot;)
sf1994 &lt;- read_excel(&quot;elsec94.xls&quot;)
sf1995 &lt;- read_excel(&quot;elsec95.xls&quot;)
sf1996 &lt;- read_excel(&quot;elsec96.xls&quot;)
sf1997 &lt;- read_excel(&quot;elsec97.xls&quot;)
sf1998 &lt;- read_excel(&quot;elsec98.xls&quot;)
sf1999 &lt;- read_excel(&quot;elsec99.xls&quot;)
sf2000 &lt;- read_excel(&quot;elsec00.xls&quot;)
sf2001 &lt;- read_excel(&quot;elsec01.xls&quot;)
sf2002 &lt;- read_excel(&quot;elsec02.xls&quot;)
sf2003 &lt;- read_excel(&quot;elsec03.xls&quot;)
sf2004 &lt;- read_excel(&quot;elsec04.xls&quot;)
sf2005 &lt;- read_excel(&quot;elsec05.xls&quot;)
sf2006 &lt;- read_excel(&quot;elsec06.xls&quot;)
sf2007 &lt;- read_excel(&quot;elsec07.xls&quot;)
sf2008 &lt;- read_excel(&quot;elsec08.xls&quot;)
sf2009 &lt;- read_excel(&quot;elsec09.xls&quot;)
sf2010 &lt;- read_excel(&quot;elsec10.xls&quot;)
sf2011 &lt;- read_excel(&quot;elsec11.xls&quot;)
sf2012 &lt;- read_excel(&quot;elsec12.xls&quot;)
sf2013 &lt;- read_excel(&quot;elsec13.xls&quot;)
sf2014 &lt;- read_excel(&quot;elsec14.xls&quot;)
sf2015 &lt;- read_excel(&quot;elsec15.xls&quot;)

#Add YEAR Column, No M/D
sf1993$YEAR &lt;- as.character(&quot;1993&quot;)
sf1994$YEAR &lt;- as.character(&quot;1994&quot;)
sf1995$YEAR &lt;- as.character(&quot;1995&quot;)
sf1996$YEAR &lt;- as.character(&quot;1996&quot;)
sf1997$YEAR &lt;- as.character(&quot;1997&quot;)
sf1998$YEAR &lt;- as.character(&quot;1998&quot;)
sf1999$YEAR &lt;- as.character(&quot;1999&quot;)
sf2000$YEAR &lt;- as.character(&quot;2000&quot;)
sf2001$YEAR &lt;- as.character(&quot;2001&quot;)
sf2002$YEAR &lt;- as.character(&quot;2002&quot;)
sf2003$YEAR &lt;- as.character(&quot;2003&quot;)
sf2004$YEAR &lt;- as.character(&quot;2004&quot;)
sf2005$YEAR &lt;- as.character(&quot;2005&quot;)
sf2006$YEAR &lt;- as.character(&quot;2006&quot;)
sf2007$YEAR &lt;- as.character(&quot;2007&quot;)
sf2008$YEAR &lt;- as.character(&quot;2008&quot;)
sf2009$YEAR &lt;- as.character(&quot;2009&quot;)
sf2010$YEAR &lt;- as.character(&quot;2010&quot;)
sf2011$YEAR &lt;- as.character(&quot;2011&quot;)
sf2012$YEAR &lt;- as.character(&quot;2012&quot;)
sf2013$YEAR &lt;- as.character(&quot;2013&quot;)
sf2014$YEAR &lt;- as.character(&quot;2014&quot;)
sf2015$YEAR &lt;- as.character(&quot;2015&quot;)</code></pre>
</div>
<h3 id="import-inflation-data-and-tidy-the-data">Import Inflation Data and Tidy The Data</h3>
<p>At this part, we’re limiting the raw data to the revenue sources, along with a few other identifiers and more granular funding sources that will get accounted into the larger buckets of Federal, State, &amp; Local revenues but are interesting to see in our table nonetheless.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
#Introduce Inflation
inflation &lt;- read_csv(&quot;data/inflation.csv&quot;, col_types = cols(YEAR_S = col_character()))

#Select Only Those Variables of Interest
t1993 &lt;- dplyr::select(sf1993, one_of(c(&quot;STATE&quot;, &quot;ID&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t1994 &lt;- dplyr::select(sf1994, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t1995 &lt;- dplyr::select(sf1995, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t1996 &lt;- dplyr::select(sf1996, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t1997 &lt;- dplyr::select(sf1997, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t1998 &lt;- dplyr::select(sf1998, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t1999 &lt;- dplyr::select(sf1999, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2000 &lt;- dplyr::select(sf2000, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2001 &lt;- dplyr::select(sf2001, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2002 &lt;- dplyr::select(sf2002, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2003 &lt;- dplyr::select(sf2003, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2004 &lt;- dplyr::select(sf2004, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2005 &lt;- dplyr::select(sf2005, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2006 &lt;- dplyr::select(sf2006, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2007 &lt;- dplyr::select(sf2007, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2008 &lt;- dplyr::select(sf2008, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2009 &lt;- dplyr::select(sf2009, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2010 &lt;- dplyr::select(sf2010, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2011 &lt;- dplyr::select(sf2011, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2012 &lt;- dplyr::select(sf2012, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2013 &lt;- dplyr::select(sf2013, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2014 &lt;- dplyr::select(sf2014, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))
t2015 &lt;- dplyr::select(sf2015, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;V33&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;T06&quot;, &quot;U97&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))</code></pre>
</div>
<h3 id="recode-additional-variables-of-interest">Recode Additional Variables of Interest</h3>
<p>Truth be told, many databases use strange identifiers to identify what those variables represent. In the census dataset, they used some names that are easy to interpret at first glance. For instance, <code>TOTALREV</code> equals “Total Revenue”. However, some variables aren’t easily interpretable. For my purposes, I wanted to create more readable names for some of the variables I pulled in earlier. This code does that.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
#Recode 1993 Variables
t1993 &lt;- rename(t1993,  
                ENROLL = V33,
                IDCENSUS = ID,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 1994 Variables
t1994 &lt;- rename(t1994,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 1995 Variables
t1995 &lt;- rename(t1995,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 1996 Variables
t1996 &lt;- rename(t1996,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 1997 Variables
t1997 &lt;- rename(t1997,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 1998 Variables
t1998 &lt;- rename(t1998,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 1999 Variables
t1999 &lt;- rename(t1999,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2000 Variables
t2000 &lt;- rename(t2000,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2001 Variables
t2001 &lt;- rename(t2001,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2002 Variables
t2002 &lt;- rename(t2002,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2003 Variables
t2003 &lt;- rename(t2003,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2004 Variables
t2004 &lt;- rename(t2004,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2005 Variables
t2005 &lt;- rename(t2005,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)
#Recode 2006 Variables
t2006 &lt;- rename(t2006,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2007 Variables
t2007 &lt;- rename(t2007,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2008 Variables
t2008 &lt;- rename(t2008,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2009 Variables
t2009 &lt;- rename(t2009,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2010 Variables
t2010 &lt;- rename(t2010,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2011 Variables
t2011 &lt;- rename(t2011,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2012 Variables
t2012 &lt;- rename(t2012,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2013 Variables
t2013 &lt;- rename(t2013,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2014 Variables
t2014 &lt;- rename(t2014,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

#Recode 2015 Variables
t2015 &lt;- rename(t2015,  
                ENROLL = V33,
                PROPTAX = T06,
                MISCREV = U97)

inflation &lt;- rename(inflation, 
                    INDEX = Index,
                    YEAR = YEAR_S)</code></pre>
</div>
<h3 id="add-the-bls-education-inflation-index">Add The BLS Education Inflation Index</h3>
<p>Here, we’re combining the inflation data from <a href="https://data.bls.gov/cgi-bin/surveymost?cu">the BLS Education Inflation Index</a> alongside their annual counterparts from the census files so we can multiply the index value by each year’s recorded funding amount. Once we do that, we’ll have our inflation adjusted figures and be able to visualize them.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
#Add Inflation Index
inflation &lt;- inflation %&gt;% as_tibble() %&gt;% mutate(
  Annual = NULL)
t1993 &lt;- left_join(t1993, inflation, by =&quot;YEAR&quot;)
t1994 &lt;- left_join(t1994, inflation, by =&quot;YEAR&quot;)
t1995 &lt;- left_join(t1995, inflation, by =&quot;YEAR&quot;)
t1996 &lt;- left_join(t1996, inflation, by =&quot;YEAR&quot;)
t1997 &lt;- left_join(t1997, inflation, by =&quot;YEAR&quot;)
t1998 &lt;- left_join(t1998, inflation, by =&quot;YEAR&quot;)
t1999 &lt;- left_join(t1999, inflation, by =&quot;YEAR&quot;)
t2000 &lt;- left_join(t2000, inflation, by =&quot;YEAR&quot;)
t2001 &lt;- left_join(t2001, inflation, by =&quot;YEAR&quot;)
t2002 &lt;- left_join(t2002, inflation, by =&quot;YEAR&quot;)
t2003 &lt;- left_join(t2003, inflation, by =&quot;YEAR&quot;)
t2004 &lt;- left_join(t2004, inflation, by =&quot;YEAR&quot;)
t2005 &lt;- left_join(t2005, inflation, by =&quot;YEAR&quot;)
t2006 &lt;- left_join(t2006, inflation, by =&quot;YEAR&quot;)
t2007 &lt;- left_join(t2007, inflation, by =&quot;YEAR&quot;)
t2008 &lt;- left_join(t2008, inflation, by =&quot;YEAR&quot;)
t2009 &lt;- left_join(t2009, inflation, by =&quot;YEAR&quot;)
t2010 &lt;- left_join(t2010, inflation, by =&quot;YEAR&quot;)
t2011 &lt;- left_join(t2011, inflation, by =&quot;YEAR&quot;)
t2012 &lt;- left_join(t2012, inflation, by =&quot;YEAR&quot;)
t2013 &lt;- left_join(t2013, inflation, by =&quot;YEAR&quot;)
t2014 &lt;- left_join(t2014, inflation, by =&quot;YEAR&quot;)
t2015 &lt;- left_join(t2015, inflation, by =&quot;YEAR&quot;)</code></pre>
</div>
<h3 id="adjust-our-data-for-inflation">Adjust Our Data for Inflation</h3>
<p>As mentioned before, we’ll be using data from <a href="https://data.bls.gov/cgi-bin/surveymost?cu">the Bureau of Labor &amp; Statistics’ Education Inflation Index</a> to calculate our inflation adjusted figures.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
t1993e &lt;- t1993 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t1994e &lt;- t1994 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t1995e &lt;- t1995 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t1996e &lt;- t1996 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t1997e &lt;- t1997 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t1998e &lt;- t1998 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t1999e &lt;- t1999 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2000e &lt;- t2000 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2001e &lt;- t2001 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)


t2002e &lt;- t2002 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2003e &lt;- t2003 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2004e &lt;- t2004 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2005e &lt;- t2005 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2006e &lt;- t2006 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2007e &lt;- t2007 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2008e &lt;- t2008 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2009e &lt;- t2009 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2010e &lt;- t2010 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2011e &lt;- t2011 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2012e &lt;- t2012 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2013e &lt;- t2013 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2014e &lt;- t2014 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)

t2015e &lt;- t2015 %&gt;% as_tibble() %&gt;% mutate(
  TOTALREVe = TOTALREV*IndexED,
  TFEDREVe = TFEDREV*IndexED,
  TSTREVe = TSTREV*IndexED,
  TLOCREVe = TLOCREV*IndexED,
  PROPTAXe = PROPTAX*IndexED,
  MISCREVe = MISCREV*IndexED,
  TOTALEXPe = TOTALEXP*IndexED,
  TCURELSCe = TCURELSC*IndexED)</code></pre>
</div>
<h3 id="merge-all-datasets-into-one">Merge All Datasets Into One</h3>
<p>At this point, once each of our individual datasets that are adjusted for inflation are compiled, we can merge them into one single dataset that is one step closer to being visualized.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
full.94e &lt;- bind_rows(t1993e, t1994e)
full.95e &lt;- bind_rows(full.94e, t1995e)
full.96e &lt;- bind_rows(full.95e, t1996e)
full.97e &lt;- bind_rows(full.96e, t1997e)
full.98e &lt;- bind_rows(full.97e, t1998e)
full.99e &lt;- bind_rows(full.98e, t1999e)
full.00e &lt;- bind_rows(full.99e, t2000e)
full.01e &lt;- bind_rows(full.00e, t2001e)
full.02e &lt;- bind_rows(full.01e, t2002e)
full.03e &lt;- bind_rows(full.02e, t2003e)
full.04e &lt;- bind_rows(full.03e, t2004e)
full.05e &lt;- bind_rows(full.04e, t2005e)
full.06e &lt;- bind_rows(full.05e, t2006e)
full.07e &lt;- bind_rows(full.06e, t2007e)
full.08e &lt;- bind_rows(full.07e, t2008e)
full.09e &lt;- bind_rows(full.08e, t2009e)
full.10e &lt;- bind_rows(full.09e, t2010e)
full.11e &lt;- bind_rows(full.10e, t2011e)
full.12e &lt;- bind_rows(full.11e, t2012e)
full.13e &lt;- bind_rows(full.12e, t2013e)
full.14e &lt;- bind_rows(full.13e, t2014e)
full25e &lt;- bind_rows(full.14e, t2015e)

full25 &lt;- dplyr::select(full25e, one_of(c(&quot;STATE&quot;, &quot;IDCENSUS&quot;, &quot;YEAR&quot;, &quot;NAME&quot;, &quot;SCHLEV&quot;, &quot;ENROLL&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;,&quot;TLOCREV&quot;, &quot;PROPTAX&quot;, &quot;MISCREV&quot;, &quot;TOTALEXP&quot;, &quot;TCURELSC&quot;)))</code></pre>
</div>
<h3 id="add-fips-state-codes-to-our-datasets">Add FIPS State Codes To Our Datasets</h3>
<p>To take full advantage of the <code>geofacet</code> package, I used FIPS code identifiers to help identify each state. For more on what FIPS is, <a href="https://www.census.gov/geo/reference/ansi_statetables.html">check this page out</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
#Import the FIPS state codes
fipscode &lt;- read_csv(&quot;data/FIPSStates.csv&quot;, col_types = cols(`census id` = col_character()))

#Remove Unnecessary Columns
fipscode &lt;- fipscode %&gt;% as_tibble() %&gt;% mutate(&quot;Official USPS Code&quot; = NULL)

#Rename the FIPS id column to &#39;STATE&#39;, which we&#39;ll use to replace our current column identifying each state.  
fipscode &lt;- rename(fipscode, STATE = &quot;census id&quot;)

#Add the New State ID to our Uniform Dataset
fullest &lt;- left_join(full25, fipscode, by =&quot;STATE&quot;)

#Remove All Columns Except our Major Revenue Columns
full25a &lt;- dplyr::select(fullest, one_of(c(&quot;YEAR&quot;,&quot;Name&quot;, &quot;TOTALREV&quot;, &quot;TFEDREV&quot;, &quot;TSTREV&quot;, &quot;TLOCREV&quot;)))

#Change our YEAR column to a Date Format
full25a &lt;- rename(full25a, State = Name) %&gt;%
  mutate(YEAR=as.Date(YEAR, format = &quot;%Y&quot;))
  
#Begin Summarizing our Data by Year &amp; State
full25b &lt;- full25a %&gt;% group_by(YEAR,State) %&gt;% summarise_each(funs(sum))

#Now that we have summarized data, calculate the share of revenue by diving each of the three revenue source amounts by the total amount of revenue in that state each year.
full25b &lt;- full25b %&gt;% as_tibble() %&gt;% mutate(
  PctFED = (TFEDREV/TOTALREV)*100,
  PctSTA = (TSTREV/TOTALREV)*100,
  PctLOC = (TLOCREV/TOTALREV)*100)
  
  
#Remove the Total Revenue Column
full25c &lt;- dplyr::select(full25b, one_of(c(&quot;YEAR&quot;, &quot;State&quot;, &quot;PctFED&quot;, &quot;PctSTA&quot;, &quot;PctLOC&quot;)))

#Rename Columns with Printable Identifiers
full25c &lt;- rename(full25c, 
                 &quot;Federal Revenue&quot; = PctFED,
                 &quot;State Revenue&quot; = PctSTA,
                 &quot;Local Revenue&quot; = PctLOC)

#Transform the Data Longways for Visualization Purposes
fullest25e &lt;- gather(full25c, &quot;Source&quot;, &quot;Percent&quot;, 3:5)
yearly_avg &lt;- fullest25e %&gt;% group_by(YEAR,Source) %&gt;% summarise(Annual_Avg = mean(Percent))</code></pre>
</div>
<h3 id="plot-the-school-finance-map">Plot The School Finance Map</h3>
<p>At this point, we’ll use the <code>geofacet</code> and <code>ggplot2</code> packages to visualize our data. For style purposes, I’ve used a theme from the <code>ggthemes</code> package to make the visualization a bit cleaner, along with a few custom theme stylings. Once you run this, you should be able to reproduce the visualization I shared at the top of this post.</p>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
showtext::showtext_auto()

gg &lt;- ggplot(arrange(fullest25e,Source,YEAR), aes(x = YEAR, y =Percent, fill = Source, group = Source)) +
  geom_area(alpha = 0.8, position = &#39;stack&#39;) +
  scale_fill_manual(values = c(&quot;#ef8a62&quot;, &quot;#d1e5f0&quot;, &quot;#67a9cf&quot;)) +
  facet_geo(~ State, grid = &quot;us_state_grid2&quot;) +
  scale_x_date(expand=c(0,0), date_breaks=&quot;7 year&quot;, date_labels = &quot;%Y&quot;, limits = c(as.Date(c(&quot;1993-02-27&quot;, &quot;2016-06-01&quot;)))) +
  scale_y_continuous(expand = c(0, 0)) +
  labs(title = &quot;How Schools Were Paid For Over The Past 25 Years, 1993-2015&quot;,
       subtitle=&quot;The chart shows annual school funding shares in each state by federal, state, and local sources.&quot;,
       caption = &quot;Data Source: US Census, Public Finance Survey \nNote: Figures are adjusted for inflation using the BLS Education Index.&quot;,
       x = &quot;Year&quot;,
       y = &quot;Percentage of Overall Funding&quot;) + 
  theme_hc() + 
  theme(text = element_text(color = &quot;#4D4D4D&quot;),
        plot.title=element_text(face=&quot;bold&quot;, size = 40),
        plot.subtitle=element_text(size=24),
        plot.caption=element_text(size=14),
        legend.title=element_text(size = 18, face=&quot;bold&quot;),
        legend.text = element_text(size = 18),
        legend.position = c(.85, 0.2),
        legend.box.just = &quot;right&quot;,
        legend.key.size = unit(1, &quot;cm&quot;),
        axis.title.y = element_text(color = &quot;#4D4D4D&quot;, face=&#39;bold&#39;),
        axis.title.x = element_text(size = 14, color = &quot;#4D4D4D&quot;, face=&#39;bold&#39;),
        strip.text.x = element_text(size = 11.5, color = &quot;#4D4D4D&quot;, face=&#39;bold&#39;),
        strip.text.y = element_text(size = 14, color = &quot;#4D4D4D&quot;, face=&#39;bold&#39;),
        strip.background = element_rect(fill = &quot;#ffffff&quot;, color = NA)) +
        guides(fill=guide_legend(direction = &quot;vertical&quot;, 
                                 title.position = &quot;top&quot;, 
                                 label.position = &quot;right&quot;, 
                                 byrow=TRUE, 
                                 title=&quot;Source of Funding&quot;))

# Save The Plot as a .png file
ggsave(&quot;SFNationalMapOT.png&quot;, plot = gg, device = &quot;png&quot;, dpi=300,  width = 20, height = 12)</code></pre>
</div>
<hr />
<h1 id="bonus-school-finance-map">Bonus School Finance Map</h1>
<p>While I had limited time to produce the code-through for the first map, here’s an extra map that shows how much each state’s per pupil funding compares to the national average since 1992. One note about this one is that it uses the All-Consumer series inflation index from the Bureau of Labor &amp; Statistics for 1992, while the 1993 data onward uses the BLS Education Index.</p>
<div class="layout-chunk" data-layout="l-page">
<p><img src="SFNationalMapPP.png" width="2700" /></p>
</div>
<h2 id="corrections" class="appendix">Corrections</h2>
<p>If you see mistakes or want to suggest changes, please create an <a href="https://github.com/mrworthington/mrworthington.github.io/issues">issue</a> on the source repository.</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Before 1992, the method of collection for the census didn’t disaggregate federal revenues from state revenues because federal dollars were technically implemented through the state. However, since 1992, the census shifted their reporting protocols for states and began requesting that each state delineate between their contributions versus what the federal government provided.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>While this method of collection started in 1992, our analysis will start in 1993 because that is when <a href="https://data.bls.gov/cgi-bin/surveymost?cu">the Bureau of Labor &amp; Statistics introduced their Education Inflation Index</a>, which was meant to provide clarity on a dollar’s value in the education space.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Worthington (2018, March 28). Matt Worthington: Visualizing American School Finance. Retrieved from https://mrworthington.com/posts/school-finance-analysis/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{worthington2018visualizing,
  author = {Worthington, Matt},
  title = {Matt Worthington: Visualizing American School Finance},
  url = {https://mrworthington.com/posts/school-finance-analysis/},
  year = {2018}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <p>© Copyright 2020 <a href="https://github.com/mrworthington">Matt Worthington</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
