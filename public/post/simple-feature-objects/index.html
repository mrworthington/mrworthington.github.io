<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>An Exploration of Simple Features for R</title>
  <meta property="og:title" content="An Exploration of Simple Features for R" />
  <meta name="twitter:title" content="An Exploration of Simple Features for R" />
  <meta name="description" content="Exploration of the implementation of simple features standard by the sf package for R">
  <meta property="og:description" content="Exploration of the implementation of simple features standard by the sf package for R">
  <meta name="twitter:description" content="Exploration of the implementation of simple features standard by the sf package for R">
  <meta name="author" content="Matt Worthington"/>
  <link href='../../img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@mrworthington" />
  <meta name="twitter:creator" content="@mrworthington" />
  <meta property="og:url" content="/post/simple-feature-objects/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Matt Worthington" />


  <meta name="generator" content="Hugo 0.36" />
  <link rel="canonical" href="../../post/simple-feature-objects/" />
  <link rel="alternate" href="../../index.xml" type="application/rss+xml" title="Matt Worthington">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="../../css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,600" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,600" />  
  <link rel="stylesheet" href="../../css/highlight.min.css" />



</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../">Matt Worthington</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="../../">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Projects" href="../../project/">Projects</a>
            </li>
          
        
          
            <li>
              <a title="Courses" href="../../course/">Courses</a>
            </li>
          
        
          
            <li>
              <a title="CV" href="../../page/cv/">CV</a>
            </li>
          
        
          
            <li>
              <a title="About" href="../../page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="../../tags">Tags</a>
            </li>
          
        

        


        
      </ul>
    </div>




  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>An Exploration of Simple Features for R</h1>
                
                  
                    <h2 class="post-subheading">Building sfg, sfc, and sf objects from the sf package</h2>
                  
                
                
                  <span class="post-meta">
  Posted on March 12, 2018
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>My <a href="https://jessesadler.com/post/gis-with-r-intro/">previous post</a> provided an introduction to the <a href="https://cran.r-project.org/web/packages/sp/index.html"><code>sp</code></a> and <a href="https://cran.r-project.org/web/packages/sf/index.html"><code>sf</code></a> packages, showing how the two packages represent spatial data in R. There I discussed the creation of <code>Spatial</code> and <code>sf</code> objects from data with longitude and latitude values and the process of making maps with the two packages. In this post I will go further into the details of the <code>sf</code> package by examining the structure of <code>sf</code> objects and how the package implements the <a href="http://www.opengeospatial.org/standards/sfa">Simple Features open standard</a>.</p>

<p>
It is certainly not necessary to know the ins and outs of <code>sf</code> objects and the Simple Features standard to use the package — it has taken me long enough to get my head around much of this — but a better knowledge of the structure and vocabulary of <code>sf</code> objects is helpful for understanding the effects of the plethora of <code>sf</code> functions. There are a variety of good resources that discuss the structure of <code>sf</code> objects. The most comprehensive are the <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">package vignette Simple Features for R</a> and the overview in Chapter 2 of the working book <a href="https://geocompr.robinlovelace.net/spatial-class.html#sf-classes"><em>Geocomputation with R</em> by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow</a>. This post is based on these sources, as well as my own sleuthing through the code for the <code>sf</code> package.</p>

<p>Before diving in, let&rsquo;s take a step back to provide some background to the package. The <code>sf</code> package implements the <a href="https://en.wikipedia.org/wiki/Simple_Features">Simple Features standard</a> in R. The Simple Features standard is widely used by GIS software such as <a href="http://postgis.net/">PostGIS</a>, <a href="http://geojson.org/">GeoJSON</a>, and <a href="http://www.esri.com/">ArcGIS</a> to represent geographic vector data. The <code>sf</code> package is designed to bring spatial analysis in R in line with these other systems.<sup class="footnote-ref" id="fnref:1"><a rel="footnote" href="#fn:1">1</a></sup> The standard defines a simple feature as a representation of a real world object by a point or points that may or may not be connected by straight line segments to form lines or polygons. A simple feature can contain both a geometry that includes points, any connecting lines, and a coordinate reference system to identify its location of Earth and attributes to describe the object, such as a name, values, color, etc. The <code>sf</code> package takes advantage of the wide use of Simple Features by linking directly to the <a href="http://gdal.org">GDAL</a>, <a href="http://trac.osgeo.org/geos">GEOS</a>, and <a href="http://proj4.org">PROJ</a> libraries that provide the back end for reading spatial data, making geographic calculations, and handling coordinate reference systems.<sup class="footnote-ref" id="fnref:2"><a rel="footnote" href="#fn:2">2</a></sup></p>

<!--more-->

<p>You can see that <code>sf</code> links to these GIS libraries from the message given when loading the package, so let&rsquo;s do that now.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="kn">library</span><span class="p">(</span>sf<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Linking to GEOS 3.6.1, GDAL 2.1.3, proj.4 4.9.3</pre></div>
<p>With this general definition of Simple Features in mind, we can look at how the <code>sf</code> package implements the standard through the <code>sf</code> class of object.<sup class="footnote-ref" id="fnref:3"><a rel="footnote" href="#fn:3">3</a></sup> At its most basic, an <code>sf</code> object is a collection of simple features that includes attributes and geometries in the form of a data frame. In other words, it is a data frame (or tibble) with rows of features, columns of attributes, and a special geometry column that contains the spatial aspects of the features. The special geometry column is itself a <a href="http://colinfay.me/intro-to-r/lists-and-data-frames.html">list</a> of class <code>sfc</code>, which is made up of individual objects of class <code>sfg</code>. While it is possible to have multiple geometry columns, <code>sf</code> objects usually only possess a single geometry column. We can break down the components of an <code>sf</code> object by looking at its printed output.<sup class="footnote-ref" id="fnref:4"><a rel="footnote" href="#fn:4">4</a></sup></p>

<p><img src="../../img/simple-feature-objects/sf-object.tiff" height="400" /></p>

<ul>
<li><code>sf</code> object: collection of simple features represented by a data frame</li>
<li>attributes: non-geometry variables or columns in the data frame</li>
<li>feature: a single simple feature with attributes and geometry represented by a row in the data frame</li>
<li><code>sfg</code> object: geometry of a single feature</li>
<li><code>sfc</code> object: geometry column with the spatial attributes of the object printed above the data frame</li>
</ul>

<p>This terminology covers the basics for <code>sf</code> objects and provides the majority of information you need to work with them. The most likely way to create an <code>sf</code> object is convert another type of spatial object or a data frame with coordinates to an <code>sf</code> object. Rarely is there a reason to create an <code>sf</code> object from scratch. However, we can learn more about the nature of <code>sf</code> objects by delving further into their structure and explicating how <code>sfg</code> and <code>sfc</code> objects combine to store spatial data. The rest of the post will do this by creating an <code>sf</code> object step-by-step from a single <code>sfg</code> object, to a combination of <code>sfg</code> objects in an <code>sfc</code> object, and finally the addition of attributes to produce a full <code>sf</code> object.</p>

<h2 id="sfg"><code>sfg</code> objects</h2>

<p><code>sfg</code> objects represent the geometry of a single feature and contains information about the feature&rsquo;s coordinates, dimension, and type of geometry. The coordinates are the values of the point or points in the feature, which can have two-, three-, or four dimensions. The vast majority of data is two dimensional, possessing and X and Y coordinates, but the Simple Features standard also possesses a Z coordinate for elevation and an M coordinate for information about the measurement of a point that is rarely used. The geometry type indicates the shape of the feature, whether it consists of a point, multiple points, a line, multiple lines, a polygon, multiple polygons, or some combination of these. There are seventeen different possible types of geometries, but the vast majority of data will use the seven main types discussed here.<sup class="footnote-ref" id="fnref:5"><a rel="footnote" href="#fn:5">5</a></sup></p>

<h4 id="geometry-types">Geometry types</h4>

<ul>
<li>POINT: a single point</li>
<li>MULTIPOINT: multiple points</li>
<li>LINESTRING: sequence of two or more points connected by straight lines</li>
<li>MULTILINESTRING: multiple lines</li>
<li>POLYGON: a closed ring with zero or more interior holes</li>
<li>MULTIPOLYGON: multiple polygons</li>
<li>GEOMETRYCOLLECTION: any combination of the above types</li>
</ul>

<p>Within the Simple Features standard the geometry of a feature is encoded using <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html#wkb">well-known binary</a> (WKB) that can also be represented in a more human readable form of well-known text (WKT). The <code>sf</code> package can convert between <code>sfg</code> and WKB or WKT very quickly, but <code>sfg</code> objects are created and stored in R as vectors, matrices, or lists of matrices depending on the geometry type.</p>

<h4 id="creating-geometry-types">Creating geometry types</h4>

<ul>
<li>POINT: a vector</li>
<li>MULTIPOINT and LINESTRING: a matrix with each row representing a point</li>
<li>MULTILINESTRING and POLYGON: a list of matrices</li>
<li>MULTIPOLYGON: a list of lists of matrices</li>
<li>GEOMETRYCOLLECTION: list that combines any of the above</li>
</ul>

<p>An <code>sfg</code> object of each of the seven main geometry types can be created through separate functions: <code>st_point()</code>, <code>st_multipoint()</code>, <code>st_linestring()</code>, etc. The functions all have two arguments: an R object of the proper class to create the specified geometry type and identification of dimensions as either XYZ or XYM if the data has three dimensions. In this post I will create POINT, MULTIPOINT, and LINESTRING geometry types, which are the most likely to be used when creating an <code>sf</code> object from scratch and provide the basis for the remaining types. You can see how to create the remaining types in the package <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html">vignette</a> and <a href="https://geocompr.robinlovelace.net/spatial-class.html#sf-classes"><em>Geocomputation with R</em></a>. Let&rsquo;s start by creating two points using vectors of longitude and latitude values for points in Los Angeles and Amsterdam.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create sfg objects with coordinates of Los Angeles and Amsterdam</span>
la_sfg <span class="o">&lt;-</span> st_point<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">-118.2615805</span><span class="p">,</span> <span class="m">34.1168926</span><span class="p">))</span>
amsterdam_sfg <span class="o">&lt;-</span> st_point<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">4.8979755</span><span class="p">,</span> <span class="m">52.3745403</span><span class="p">))</span></code></pre></div>
<p>The relative simplicity of the command to create an <code>sfg</code> POINT underlines the simplicity of <code>sfg</code> objects as a whole. We can see this by taking a closer look at the information contained in these objects.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Print sfg POINT objects</span>
la_sfg</code></pre></div><div class="highlight"><pre class="chroma">## POINT (-118.2616 34.11689)</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r">amsterdam_sfg</code></pre></div><div class="highlight"><pre class="chroma">## POINT (4.897976 52.37454)</pre></div>
<p>The printing method for all <code>sfg</code> objects uses the well-known text style with the geometry type printed in capital letters followed by the coordinates, using commas and parentheses to distinguish between the different elements for each feature.<sup class="footnote-ref" id="fnref:6"><a rel="footnote" href="#fn:6">6</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Structure of a sfg POINT object</span>
str<span class="p">(</span>la_sfg<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Classes &#39;XY&#39;, &#39;POINT&#39;, &#39;sfg&#39;  num [1:2] -118.3 34.1</pre></div>
<p>If we look a bit further into the structure of an <code>sfg</code> object, we can see that it consists of three classes corresponding to the dimensions, geometry type, and the <code>sfg</code> class itself. In addition, the object possesses coordinates, which is a vector of length two. The coordinates can also be represented by a matrix with two columns and one row. In fact, all <code>sfg</code> objects can be represented as a matrix of coordinates, though more complex geometry types contain additional columns to keep track of the pieces that make up the feature or features.<sup class="footnote-ref" id="fnref:7"><a rel="footnote" href="#fn:7">7</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Coordinates of a sfg object</span>
st_coordinates<span class="p">(</span>la_sfg<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">##           X        Y
## 1 -118.2616 34.11689</pre></div>
<p>Points are the building block for all other geometry types. We can see this by creating MULTIPOINT and LINESTRING simple feature geometries, which are both formed by a matrix of points. The matrix can be created by using <code>rbind()</code> to bind the coordinate vectors together into rows.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Matrix of points</span>
<span class="kp">rbind</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">-118.2615805</span><span class="p">,</span> <span class="m">34.1168926</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="m">4.8979755</span><span class="p">,</span> <span class="m">52.3745403</span><span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma">##             [,1]     [,2]
## [1,] -118.261580 34.11689
## [2,]    4.897976 52.37454</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create MULTIPOINT and LINESTRING sfg objects through matrix of points</span>
multipoint_sfg <span class="o">&lt;-</span> st_multipoint<span class="p">(</span><span class="kp">rbind</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">-118.2615805</span><span class="p">,</span> <span class="m">34.1168926</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="m">4.8979755</span><span class="p">,</span> <span class="m">52.3745403</span><span class="p">)))</span>
linestring_sfg <span class="o">&lt;-</span> st_linestring<span class="p">(</span><span class="kp">rbind</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">-118.2615805</span><span class="p">,</span> <span class="m">34.1168926</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="m">4.8979755</span><span class="p">,</span> <span class="m">52.3745403</span><span class="p">)))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Print objects</span>
multipoint_sfg</code></pre></div><div class="highlight"><pre class="chroma">## MULTIPOINT (-118.2616 34.11689, 4.897976 52.37454)</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r">linestring_sfg</code></pre></div><div class="highlight"><pre class="chroma">## LINESTRING (-118.2616 34.11689, 4.897976 52.37454)</pre></div>
<p>Printing the two new <code>sfg</code> objects shows their basic similarity. They were created by the same matrix and thus have the same coordinates. The only difference is that one is of class MULTIPOINT and the other is of class LINESTRING. In other words, the geometry of <code>multipoint_sfg</code> consists of points, and the geometry of <code>linestring_sfg</code> is a straight line between the same two points. We can see this by plotting the objects next to each other.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r">par<span class="p">(</span>mar <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
    mfrow <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>
plot<span class="p">(</span>multipoint_sfg<span class="p">,</span> main <span class="o">=</span> <span class="s">&#34;MULTIPOINT&#34;</span><span class="p">)</span>
plot<span class="p">(</span>linestring_sfg<span class="p">,</span> main <span class="o">=</span> <span class="s">&#34;LINESTRING&#34;</span><span class="p">)</span></code></pre></div>
<p><img src="../../img/simple-feature-objects/multipoint-linestring-plot.png" height="300" /></p>

<p>As important as what type of information is contained in <code>sfg</code> objects is, what is missing is equally significant in understanding their role within <code>sf</code> objects. <code>sfg</code> objects consist of a dimension, geometry type, and coordinates, but though they possess spatial aspects, they are not geospatial. <code>sfg</code> objects do not possess a <a href="https://jessesadler.com/post/gis-with-r-intro/#crs">coordinate reference system (CRS)</a>. There is nothing within the structure of an <code>sfg</code> object to indicate that the X and Y values of the coordinates correspond to longitude and latitude values, much less to the datum of the coordinates. Calculating the distance between <code>la_sfg</code> and <code>amsterdam_sfg</code> demonstrates the non-geospatial nature of <code>sfg</code> objects. The calculation cannot take into account the ellipsoidal shape of Earth, nor that the distance between degrees of longitude decrease as they move towards the poles. Thus, the calculation for <code>st_distance()</code> has no direct real-world meaning. In fact, the <code>st_distance()</code> function with <code>sfg</code> objects returns the same value as the <code>dist()</code> function from the <code>stats</code> package.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Distance on sfg objects does not have real-world meaning</span>
st_distance<span class="p">(</span>la_sfg<span class="p">,</span> amsterdam_sfg<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">##          [,1]
## [1,] 124.5055</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># st_distance and stats::dist the same for sfg objects</span>
dist<span class="p">(</span><span class="kp">rbind</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">-118.2615805</span><span class="p">,</span> <span class="m">34.1168926</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="m">4.8979755</span><span class="p">,</span> <span class="m">52.3745403</span><span class="p">)))</span></code></pre></div><div class="highlight"><pre class="chroma">##          1
## 2 124.5055</pre></div>
<h2 id="sfc"><code>sfc</code> objects</h2>

<p>The geospatial aspects of an <code>sf</code> object are contained in an object of class <code>sfc</code>. The documentation for the <code>sf</code> package often refers to an <code>sfc</code> object as a simple feature geometry list column, which is the role that they play within <code>sf</code> objects. However, as a stand-alone object, an object of class <code>sfc</code> is a list of one or more <code>sfg</code> objects with attributes — in the <a href="http://colinfay.me/r-language-definition/objects.html#attributes">R sense of attributes</a> — that enable the object to possess a coordinate reference system. When an <code>sfc</code> object is printed to the console, it is referred to as a geometry set. The <code>sfc</code> class possesses seven subclasses, one for an <code>sfc</code> object composed of each of the six main geometry types and an addition subclass for an <code>sfc</code> object that contains a combination of geometry types.</p>

<h4 id="sfc-subclasses"><code>sfc</code> subclasses</h4>

<ul>
<li>sfc_POINT</li>
<li>sfc_MULTIPOINT</li>
<li>sfc_LINESTRING</li>
<li>sfc_MULTILINESTRING</li>
<li>sfc_POLYGON_</li>
<li>sfc_MULTIPOLYGON</li>
<li>sfc_MULTIPOLYGON</li>
<li>sfc_GEOMETRY</li>
</ul>

<p>The <code>st_sfc()</code> function to create an <code>sfc</code> object takes any number of <code>sfg</code> objects and a CRS in the form of either an <a href="http://www.epsg.org">EPSG code</a> or a <code>proj4string</code> from the <a href="http://proj4.org">PROJ library</a>. Internally, the <code>crs</code> argument uses the <code>st_crs()</code> function to look up either the EPSG code or <code>proj4string</code> and, if possible, set the corresponding value for the undefined <code>epsg</code> or <code>proj4string</code> through external calls to the <a href="http://gdal.org">GDAL</a> and PROJ libraries. The default CRS for an <code>sfc</code> object is <code>NA</code> or not available. Let&rsquo;s create an <code>sfc</code> object from one of the above <code>sfg</code> objects with the default CRS to see how an <code>sfc</code> object differs from an <code>sfg</code> object even when it contains the geometry of only one feature.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create sfc object with default crs</span>
st_sfc<span class="p">(</span>multipoint_sfg<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Geometry set for 1 feature 
## geometry type:  MULTIPOINT
## dimension:      XY
## bbox:           xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454
## epsg (SRID):    NA
## proj4string:    NA
## MULTIPOINT (-118.2616 34.11689, 4.897976 52.37454)</pre></div>
<p>The <code>sfc</code> print method reveals the information contained in the <code>sfg</code> object or objects used to create it, including the geometry type or <code>sfc</code> subclass, dimensions, and the coordinates printed in the same well-known text format used by the <code>sfg</code> print method.<sup class="footnote-ref" id="fnref:8"><a rel="footnote" href="#fn:8">8</a></sup> However, the <code>sfc</code> print method also reveals the addition of the <code>crs</code> attribute by printing out the <code>epsg</code> and <code>proj4string</code> values. Thus, even though in this case the geospatial aspect of the <code>sfc</code> object is left undefined, the object can be considered geospatial. Let&rsquo;s further investigate the structure of an <code>sfc</code> object by creating an <code>sfc</code> object with multiple <code>sfg</code> objects and use the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System#WGS84">EPSG code 4326</a> to identify longitude and latitude coordinates on the WGS84 ellipsoid for the CRS. Notice in the print out of the object that the <code>proj4string</code> is identified, though it was not included in the arguments.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create sfc object with multiple sfg objects</span>
points_sfc <span class="o">&lt;-</span> st_sfc<span class="p">(</span>la_sfg<span class="p">,</span> amsterdam_sfg<span class="p">,</span> crs <span class="o">=</span> <span class="m">4326</span><span class="p">)</span>
points_sfc</code></pre></div><div class="highlight"><pre class="chroma">## Geometry set for 2 features 
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## POINT (-118.2616 34.11689)
## POINT (4.897976 52.37454)</pre></div>
<p>We can see that an <code>sfc</code> object is a list and treated as such in R by running <code>View(points_sfc)</code>, which will give an output similar to any other list object. However, <code>points_sfc</code> is different from a normal list in that an <code>sfc</code> object possesses five attributes that give <code>sfc</code> objects their geospatial nature.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Attributes of sfc object</span>
<span class="kp">attributes</span><span class="p">(</span>points_sfc<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## $class
## [1] &#34;sfc_POINT&#34; &#34;sfc&#34;      
## 
## $precision
## [1] 0
## 
## $bbox
##        xmin        ymin        xmax        ymax 
## -118.261580   34.116893    4.897976   52.374540 
## 
## $crs
## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: &#34;+proj=longlat +datum=WGS84 +no_defs&#34;
## 
## $n_empty
## [1] 0</pre></div>
<p>Here, we can clearly see that <code>points_sfc</code> is of class <code>sfc</code> and subclass <code>sfc_POINT</code> since it only contains geometries of type POINT. The <code>precision</code> attribute corresponds to the precision element of the Simple Features standard and is used in certain geometric calculations. <code>bbox</code> is a calculation of the minimum and maximum values of the X and Y coordinates within the <code>sfc</code> object, and <code>n_empty</code> notes the number of empty <code>sfg</code> objects in the list. The <code>crs</code> attribute is the most interesting for our purposes and consists of a <code>crs</code> object, which itself is a list of length two containing a <code>proj4string</code> and an <code>epsg</code> value if one exists. Because the <code>crs</code> is an attribute of <code>sfc</code> objects, all geometries within an <code>sfc</code> object by definition possess the same CRS. We can inspect the contents of the <code>crs</code> attribute for <code>points_sfc</code> with the <code>st_crs()</code> function even if it does not provide us with any additional information.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># crs attribute is of class crs</span>
<span class="kp">class</span><span class="p">(</span>st_crs<span class="p">(</span>points_sfc<span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma">## [1] &#34;crs&#34;</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Access crs attribute of sfc object</span>
st_crs<span class="p">(</span>points_sfc<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: &#34;+proj=longlat +datum=WGS84 +no_defs&#34;</pre></div>
<p>We can confirm the geospatial nature of <code>points_sfc</code> by again using the <code>st_distance()</code> function. Beginning with <a href="https://github.com/r-spatial/sf/blob/master/NEWS.md">version 0.6</a> of the <code>sf</code> package, <code>st_distance()</code> uses the <a href="https://cran.r-project.org/web/packages/lwgeom/index.html"><code>lwgeom</code></a> package, which in turn links to geometric functions from the <a href="https://github.com/postgis/postgis/tree/svn-trunk/liblwgeom">liblwgeom</a> library used by PostGIS, to make geometric calculations on longitude and latitude values. Therefore, you may need to install the <code>lwgeom</code> package for the <code>st_distance()</code> function to work properly.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Geographic distance with sfc object</span>
st_distance<span class="p">(</span>points_sfc<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Units: m
##         [,1]    [,2]
## [1,]       0 8955120
## [2,] 8955120       0</pre></div>
<p>With an <code>sfc</code> object that uses longitude and latitude coordinates and a set <code>crs</code> the <code>st_distance()</code> function uses complex geometric calculations on the chosen ellipsoid to accurately calculate the distance between features. By default the function returns a dense matrix of the distance between all of the features — or <code>sfg</code> objects — contained in the <code>sfc</code> object along with the units of the values from the <a href="https://cran.r-project.org/package=units"><code>units</code></a> package. Here, we can see that the points in Los Angeles and Amsterdam are 8,955,120 meters apart from each other. You can even convert to miles or kilometers with the <code>units</code> package, but the most significant aspect of this command is how it differs from the above use of <code>st_distance()</code> with <code>sfg</code> objects. We now have usable geographical information about the two points we created.</p>

<h2 id="sf"><code>sf</code> objects</h2>

<p>Now that we have a set of geometries containing a coordinate reference system in the form of an <code>sfc</code> object, we can connect <code>points_sfc</code> to a data frame of attributes to create an <code>sf</code> object. First though, we need a data frame of attributes that provides information about the two points.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create a data frame of attributes for the two points</span>
data <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>name <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;Los Angeles&#34;</span><span class="p">,</span> <span class="s">&#34;Amsterdam&#34;</span><span class="p">),</span>
                   language <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;English&#34;</span><span class="p">,</span> <span class="s">&#34;Dutch&#34;</span><span class="p">),</span>
                   weather <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;sunny&#34;</span><span class="p">,</span> <span class="s">&#34;rainy/cold&#34;</span><span class="p">))</span></code></pre></div>
<p>The <code>st_sf()</code> function can either join a data frame to an <code>sfc</code> object of the same length or take a data frame that already contains an <code>sfc</code> list column to create an <code>sf</code> object. When joining a data frame to an <code>sfc</code> object you can name the geometry list column. Otherwise the column will be named after the <code>sfc</code> object. It is also worth pointing out that the methodology used by <code>st_sf</code> converts a tibble to a data frame, and so the output of the function will always be an object of classes <code>sf</code> and <code>data.frame</code>. Here I want to show two different ways to make an <code>sf</code> object with the <code>data</code> data frame and <code>points_sfc</code>, first by combining the two objects into a single data frame before executing the <code>sf_sf()</code> function and then letting the <code>sf_sf()</code> function do the joining. In the first method, the use of <code>cbind()</code> automatically names the geometry list column as &ldquo;geometry.&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create data frame with list column then make sf object</span>
st_sf<span class="p">(</span><span class="kp">cbind</span><span class="p">(</span>data<span class="p">,</span> points_sfc<span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma">## Simple feature collection with 2 features and 3 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##          name language    weather                   geometry
## 1 Los Angeles  English      sunny POINT (-118.2616 34.11689)
## 2   Amsterdam    Dutch rainy/cold  POINT (4.897976 52.37454)</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Make sf object from separate data frame and sfc objects</span>
st_sf<span class="p">(</span>data<span class="p">,</span> geometry <span class="o">=</span> points_sfc<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Simple feature collection with 2 features and 3 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##          name language    weather                   geometry
## 1 Los Angeles  English      sunny POINT (-118.2616 34.11689)
## 2   Amsterdam    Dutch rainy/cold  POINT (4.897976 52.37454)</pre></div>
<p>I think that the latter method is preferable, but the former method demonstrates part of the internal process of <code>st_sf()</code> when using the latter method. In either case, both methods produce the same result, and we are presented with the same print method for an <code>sf</code> object that we saw at the beginning of the post. As I noted above, the result of <code>st_sf()</code> is an object of classes <code>sf</code> and <code>data.frame</code>, showing that <code>sf</code> objects are an extension of data frames. Let&rsquo;s confirm that by creating an <code>sf</code> object and checking its class.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Create sf object by combining data frame with sfc object and name sfc column geometry</span>
points_sf <span class="o">&lt;-</span> st_sf<span class="p">(</span>data<span class="p">,</span> geometry <span class="o">=</span> points_sfc<span class="p">)</span>

<span class="c1"># Class of new sf object</span>
<span class="kp">class</span><span class="p">(</span>points_sf<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## [1] &#34;sf&#34;         &#34;data.frame&#34;</pre></div>
<p>The creation of <code>points_sf</code> does not alter the geometry or geographical information contained in <code>points_sfc</code> in any way. To confirm this we can show that the geometry of <code>points_sf</code> — accessed via the <code>st_geometry()</code> function — is equivalent to <code>points_sfc</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Geometry of points_sf is equivalent to points_sfc</span>
<span class="kp">identical</span><span class="p">(</span>st_geometry<span class="p">(</span>points_sf<span class="p">),</span> points_sfc<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## [1] TRUE</pre></div>
<p>In many ways an <code>sf</code> object can be treated as if it were a data frame, and this is one of the main advantages of working with <code>sf</code> objects over <code>Spatial</code> objects from the <code>sp</code> package. As I noted in my <a href="https://jessesadler.com/post/gis-with-r-intro/#sf">previous post</a>, you can manipulate <code>sf</code> objects using <a href="http://dplyr.tidyverse.org/"><code>dplyr</code></a> commands. However, internally <code>sf</code> objects are different from data frames in that the geometry column is designed to be sticky. In addition to the usual attributes associated with a data frame of column names, row names, and class, <code>sf</code> objects also possess an <code>sf_column</code> attribute, which is a vector of the names of the one or more geometry columns in the <code>sf</code> object.<sup class="footnote-ref" id="fnref:9"><a rel="footnote" href="#fn:9">9</a></sup> The <code>sf_column</code> attribute helps to implement the stickiness of geometry columns. The geometry column is kept in all subsetting of an <code>sf</code> object. For example, using <code>dplyr</code>&rsquo;s <code>select()</code> function with a single column name returns an <code>sf</code> object with two columns, the selected column and the geometry column.<sup class="footnote-ref" id="fnref:10"><a rel="footnote" href="#fn:10">10</a></sup></p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Stickiness of geometry column</span>
dplyr<span class="o">::</span>select<span class="p">(</span>points_sf<span class="p">,</span> name<span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">## Simple feature collection with 2 features and 1 field
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -118.2616 ymin: 34.11689 xmax: 4.897976 ymax: 52.37454
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##          name                   geometry
## 1 Los Angeles POINT (-118.2616 34.11689)
## 2   Amsterdam  POINT (4.897976 52.37454)</pre></div>
<p>If you want to remove the geometry column and transform an <code>sf</code> object to a data frame or tibble, you can use <code>as_tibble()</code> or <code>as.data.frame()</code> in a pipe before <code>select()</code>. More directly, you can remove the geometry column and convert an <code>sf</code> object to a tibble or data frame by setting the geometry to <code>NULL</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Return sf object to a data frame by setting geometry to NULL</span>
st_set_geometry<span class="p">(</span>points_sf<span class="p">,</span> <span class="kc">NULL</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma">##          name language    weather
## 1 Los Angeles  English      sunny
## 2   Amsterdam    Dutch rainy/cold</pre></div><div class="highlight"><pre class="chroma"><code class="language-.r" data-lang=".r"><span class="c1"># Class</span>
<span class="kp">class</span><span class="p">(</span>st_set_geometry<span class="p">(</span>points_sf<span class="p">,</span> <span class="kc">NULL</span><span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma">## [1] &#34;data.frame&#34;</pre></div>
<p>By converting from an <code>sf</code> object to a data frame, we have come full circle in the creation of an <code>sf</code> object from scratch.</p>

<h2 id="wrapping-up">Wrapping up</h2>

<p>The <code>sf</code> package is quickly becoming the default GIS package for use in R. It has done this by balancing the use of the Simple Features standard, enabling it to link directly to powerful GIS libraries such as PostGIS, GEOS, and GDAL, and an implementation that uses native R objects and fits within the <a href="http://tidyverse.org">tidyverse</a> set of packages and methods. Investigating the structure of <code>sf</code> objects and how they are made through <code>sfg</code> objects, a <code>sfc</code> list column, and a data frame provides insight into how a data-frame-like object is able to possess spatial data in R.</p>

<p>We can summarize the role of <code>sfg</code>, <code>sfc</code>, and <code>sf</code> objects in the following fashion:</p>

<ul>
<li><code>sfg</code>: geometry

<ul>
<li>geometry of a single feature</li>
<li>vector, matrix, or list of matrices of coordinates with defined dimension and type of geometry</li>
<li>seven main geometry types</li>
</ul></li>
<li><code>sfc</code>: geospatial geometry

<ul>
<li>list of <code>sfg</code> objects</li>
<li>coordinate reference system through <code>crs</code> attribute</li>
<li>seven subclasses based on geometries</li>
</ul></li>
<li><code>sf</code>: geospatial geometry with attributes

<ul>
<li>data frame with geometry column of class <code>sfc</code></li>
<li>sticky geometry column through <code>sf_column</code> attribute</li>
</ul></li>
</ul>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">The Simple Features standard was developed after the creation of the <code>sp</code> package, and so <code>sp</code> does not use the standard.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">Before <code>sf</code>, the primary interfaces to GDAL and GEOS were provided by the separate <a href="https://cran.r-project.org/web/packages/rgdal/index.html"><code>rgdal</code></a> and <a href="https://cran.r-project.org/web/packages/rgeos/index.html"><code>rgeos</code></a> packages.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3">There are many things called &ldquo;sf&rdquo; or &ldquo;simple features&rdquo; here, so I will try to be as clear as possible in distinguishing them.
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
<li id="fn:4">See <a href="https://jessesadler.com/post/gis-with-r-intro/">Introduction to GIS with R</a> for the code that created this object. See also the similar image in the <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf1.html#sf-objects-with-simple-features">package vignette</a>.
 <a class="footnote-return" href="#fnref:4"><sup>[return]</sup></a></li>
<li id="fn:5">The <code>sf</code> package prints the geometry types in capital letters, and I will follow this style.
 <a class="footnote-return" href="#fnref:5"><sup>[return]</sup></a></li>
<li id="fn:6">See the <a href="http://www.opengeospatial.org/standards/sfa">Implementation Standard for Geographic information - Simple feature access, pg 61</a> for examples of the well-known text style.
 <a class="footnote-return" href="#fnref:6"><sup>[return]</sup></a></li>
<li id="fn:7">See <code>help(&quot;st_coordinates&quot;)</code> for details.
 <a class="footnote-return" href="#fnref:7"><sup>[return]</sup></a></li>
<li id="fn:8">If you have more than five features, the print command will only print the first five geometries. You can alter this with an explicit print command with a defined &ldquo;n&rdquo; for the number of geometries you want to print.
 <a class="footnote-return" href="#fnref:8"><sup>[return]</sup></a></li>
<li id="fn:9">An <code>sf</code> object also contains an <code>agr</code> attribute that can categorize the non-geometry columns as either &ldquo;constant&rdquo;, &ldquo;aggregate&rdquo;, or &ldquo;identity&rdquo; values.
 <a class="footnote-return" href="#fnref:9"><sup>[return]</sup></a></li>
<li id="fn:10">Since I have not loaded the <code>dplyr</code> package in this post, I am using the <code>::</code> method to call a function from a package that is not loaded.
 <a class="footnote-return" href="#fnref:10"><sup>[return]</sup></a></li>
</ol>
</div>
        	
              
                <span class="post-meta">
                  
                    #<a href="../../tags/r">r</a>&nbsp;
                  
                </span>
              
      </article>

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:worthington.matthew@utexas.edu" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/mrworthington" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/mrworthington" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/mrworthington" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/mattworthington" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li> 
            <a href="../../index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
  
        </ul>
        <p class="credits copyright text-muted">
          Matt Worthington
          &nbsp;&bull;&nbsp;
          2018

         
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.36</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="../../js/main.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script> hljs.configure({languages: ["r"]}); hljs.initHighlightingOnLoad();</script>


<script> renderMathInElement(document.body); </script>
<script src= "/js/bigfoot.js"></script>
<script> $.bigfoot(); </script>







  </body>
</html>

