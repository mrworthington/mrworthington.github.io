---
title: "ACS + 211 Regression Analysis"
subtitle: Produced For The Spring 2Gen PRP
output:
  prettydoc::html_pretty: 
    theme: cayman
    fig_height: 6
    fig_width: 10
    toc: yes
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(GGally)
library(extrafont)
library(readr)
library(prettydoc)
library(car)
```

```{r, include=FALSE}
TrainingData=as.data.frame(read_csv("~/GitHub/Maker Space/2-Gen PRP/Test Data- ACS + 211 - Test Data- ACS + 211.csv"))
col_types = cols(`zip` = col_character())
names(TrainingData)
```

```{r, include=FALSE}
rownames(TrainingData) <- TrainingData[,1]
TrainingData <- TrainingData[,-1]
```

# Visual Analysis of Simple Linear Regression 

This first of code runs through each variable to see which are closely related to the production of 211 calls from our American Community Survey Data. 

As you can imagine, some variables like `popul` (*total population*) & `bachelors` (*those persons over 25 having at least a bachelor's degree*) have little to relationship with the occurence of 211 calls. That said, others that indicate tight confidence intervals with very closely knitted residuals warrant further investigation.

```{r}
attach(TrainingData)
#lm.fit=lm(calls~.-calls100hh,data=TrainingData)
#summary(lm.fit)
#vif(lm.fit)
#plot(fampov,lessthanHS,pch=20)
cor(fampov,lessthanHS)
plot(fampov,lessthanHS)
```


```{r cars, include=FALSE}

# add a 'fake' column
TrainingData$Residual <- seq_len(nrow(TrainingData))

# calculate all residuals prior to display
residuals <- lapply(TrainingData[3:14], function(x) {
  summary(lm(calls ~ x, data = TrainingData))$residuals
})
# calculate a consistent y range for all residuals
y_range <- range(unlist(residuals))

# custom function to display continuous data. If the y variable is "Residual", do custom work.
lm_or_resid <- function(data, mapping, ..., line_color = "red", line_size = 1) {
  if (as.character(mapping$y) != "Residual") {
    return(ggally_smooth_lm(data, mapping, ...))
  }

  # make residual data to display
  resid_data <- data.frame(
    x = data[[as.character(mapping$x)]],
    y = residuals[[as.character(mapping$x)]]
  )

  ggplot(data = data, mapping = mapping) +
    geom_hline(yintercept = 0, color = line_color, size = line_size) +
    ylim(y_range) +
    geom_point(data = resid_data, mapping = aes(x = x, y = y), ...)

}
```

```{r, echo=FALSE}
# plot the data
ggduo(
  TrainingData,
  3:6, c(1,15),
  types = list(continuous = lm_or_resid)
)
```

```{r, echo=FALSE}
# plot the data
ggduo(
  TrainingData,
  7:10, c(1,15),
  types = list(continuous = lm_or_resid)
)
```

```{r, echo=FALSE}
# plot the data
ggduo(
  TrainingData,
  11:14, c(1,15),
  types = list(continuous = lm_or_resid)
)
```

# Simple & Multiple Linear Regression Analysis of Variables

This first section tried to do a quick visual run through to identify variables that warrant further investigation. After looking at our visuals, we follow up below with the individual & synergistic impacts of the following variables:

  * `fampov`: Families whose incomes is below the poverty level  
  * `lessthanHS`: Those persons over 25 with less than a high school education
  * `nohealth`: Those person without health insurance

The outputs are as follows

##Simple LR on Calls~FamPov

```{r Simple LR on Calls~FamPov}
lm.fit=lm(calls ~ fampov,data=TrainingData)
summary(lm.fit)
```


##Simple LR on Calls~LessThanHS
```{r Simple LR on Calls~LessThanHS}
lm.fit=lm(calls ~ lessthanHS,data=TrainingData)
summary(lm.fit)
```


##Simple LR on Calls~NoHealth
```{r Simple LR on Calls~NoHealth, echo=FALSE}
lm.fit=lm(calls ~ nohealth,data=TrainingData)
summary(lm.fit)
```


##Multiple LR on Calls~FamPov + LessThanHS + NoHealth
```{r Multiple LR on Calls~FamPov+LessThanHS+NoHealth, echo=FALSE}
lm.fit=lm(calls ~ fampov+lessthanHS+nohealth,data=TrainingData)
summary(lm.fit)
```


##Multiple LR on Calls~FamPov + LessThanHS
```{r Multiple LR on Calls~FamPov+LessThanHS, echo=FALSE}
lm.fit=lm(calls ~ fampov+lessthanHS,data=TrainingData)
summary(lm.fit)
```



##Interaction Effect on Calls~FamPov x LessThanHS x NoHealth
```{r Multiple LR on Calls~FamPov*LessThanHS*NoHealth, echo=FALSE}
lm.fit=lm(calls ~ fampov*lessthanHS*nohealth,data=TrainingData)
summary(lm.fit)

```



##Interaction Effect on Calls~FamPov x LessThanHS
```{r Multiple LR on Calls~FamPov*LessThanHS, echo=FALSE}
lm.fit=lm(calls ~ fampov:lessthanHS,data=TrainingData)
summary(lm.fit)
```
```{r Multiple LR on Calls~FamPov*LessThanHS Graph, eval=FALSE, include=FALSE}
p2 <- ggplot(TrainingData, aes(calls, fampov*lessthanHS, colour = calls)) + theme_grey() + geom_point() +
  geom_smooth(method=lm)
p2
```
```


